{"ast":null,"code":"\"use strict\";\n\nvar _createForOfIteratorHelper = require(\"C:/Users/Human/Documents/MildMayhemFull/mildmayhem/client/node_modules/@babel/runtime/helpers/createForOfIteratorHelper\");\n\nvar _classCallCheck = require(\"C:/Users/Human/Documents/MildMayhemFull/mildmayhem/client/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"C:/Users/Human/Documents/MildMayhemFull/mildmayhem/client/node_modules/@babel/runtime/helpers/createClass\");\n\nvar _inherits = require(\"C:/Users/Human/Documents/MildMayhemFull/mildmayhem/client/node_modules/@babel/runtime/helpers/inherits\");\n\nvar _createSuper = require(\"C:/Users/Human/Documents/MildMayhemFull/mildmayhem/client/node_modules/@babel/runtime/helpers/createSuper\");\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function get() {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) {\n    if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  }\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Namespace = exports.Socket = exports.Server = void 0;\n\nvar http = require(\"http\");\n\nvar fs_1 = require(\"fs\");\n\nvar zlib_1 = require(\"zlib\");\n\nvar accepts = require(\"accepts\");\n\nvar stream_1 = require(\"stream\");\n\nvar path = require(\"path\");\n\nvar engine = require(\"engine.io\");\n\nvar client_1 = require(\"./client\");\n\nvar events_1 = require(\"events\");\n\nvar namespace_1 = require(\"./namespace\");\n\nObject.defineProperty(exports, \"Namespace\", {\n  enumerable: true,\n  get: function get() {\n    return namespace_1.Namespace;\n  }\n});\n\nvar parent_namespace_1 = require(\"./parent-namespace\");\n\nvar socket_io_adapter_1 = require(\"socket.io-adapter\");\n\nvar parser = __importStar(require(\"socket.io-parser\"));\n\nvar debug_1 = __importDefault(require(\"debug\"));\n\nvar socket_1 = require(\"./socket\");\n\nObject.defineProperty(exports, \"Socket\", {\n  enumerable: true,\n  get: function get() {\n    return socket_1.Socket;\n  }\n});\nvar debug = debug_1.default(\"socket.io:server\");\n\nvar clientVersion = require(\"../package.json\").version;\n\nvar dotMapRegex = /\\.map/;\n\nvar Server = /*#__PURE__*/function (_events_1$EventEmitte) {\n  _inherits(Server, _events_1$EventEmitte);\n\n  var _super = _createSuper(Server);\n\n  function Server(srv) {\n    var _this;\n\n    var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    _classCallCheck(this, Server);\n\n    _this = _super.call(this);\n    /**\n     * @private\n     */\n\n    _this._nsps = new Map();\n    _this.parentNsps = new Map();\n\n    if (\"object\" == typeof srv && srv instanceof Object && !srv.listen) {\n      opts = srv;\n      srv = null;\n    }\n\n    _this.path(opts.path || \"/socket.io\");\n\n    _this.connectTimeout(opts.connectTimeout || 45000);\n\n    _this.serveClient(false !== opts.serveClient);\n\n    _this._parser = opts.parser || parser;\n    _this.encoder = new _this._parser.Encoder();\n\n    _this.adapter(opts.adapter || socket_io_adapter_1.Adapter);\n\n    _this.sockets = _this.of(\"/\");\n    _this.opts = opts;\n    if (srv) _this.attach(srv);\n    return _this;\n  }\n\n  _createClass(Server, [{\n    key: \"serveClient\",\n    value: function serveClient(v) {\n      if (!arguments.length) return this._serveClient;\n      this._serveClient = v;\n      return this;\n    }\n    /**\n     * Executes the middleware for an incoming namespace not already created on the server.\n     *\n     * @param {String} name - name of incoming namespace\n     * @param {Object} auth - the auth parameters\n     * @param {Function} fn - callback\n     *\n     * @private\n     */\n\n  }, {\n    key: \"_checkNamespace\",\n    value: function _checkNamespace(name, auth, fn) {\n      var _this2 = this;\n\n      if (this.parentNsps.size === 0) return fn(false);\n      var keysIterator = this.parentNsps.keys();\n\n      var run = function run() {\n        var nextFn = keysIterator.next();\n\n        if (nextFn.done) {\n          return fn(false);\n        }\n\n        nextFn.value(name, auth, function (err, allow) {\n          if (err || !allow) {\n            run();\n          } else {\n            fn(_this2.parentNsps.get(nextFn.value).createChild(name));\n          }\n        });\n      };\n\n      run();\n    }\n  }, {\n    key: \"path\",\n    value: function path(v) {\n      if (!arguments.length) return this._path;\n      this._path = v.replace(/\\/$/, \"\");\n\n      var escapedPath = this._path.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, \"\\\\$&\");\n\n      this.clientPathRegex = new RegExp(\"^\" + escapedPath + \"/socket\\\\.io(\\\\.min|\\\\.msgpack\\\\.min)?\\\\.js(\\\\.map)?$\");\n      return this;\n    }\n  }, {\n    key: \"connectTimeout\",\n    value: function connectTimeout(v) {\n      if (v === undefined) return this._connectTimeout;\n      this._connectTimeout = v;\n      return this;\n    }\n  }, {\n    key: \"adapter\",\n    value: function adapter(v) {\n      if (!arguments.length) return this._adapter;\n      this._adapter = v;\n\n      var _iterator = _createForOfIteratorHelper(this._nsps.values()),\n          _step;\n\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var nsp = _step.value;\n\n          nsp._initAdapter();\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n\n      return this;\n    }\n  }, {\n    key: \"listen\",\n    value: function listen(srv) {\n      var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      return this.attach(srv, opts);\n    }\n  }, {\n    key: \"attach\",\n    value: function attach(srv) {\n      var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n      if (\"function\" == typeof srv) {\n        var msg = \"You are trying to attach socket.io to an express \" + \"request handler function. Please pass a http.Server instance.\";\n        throw new Error(msg);\n      } // handle a port as a string\n\n\n      if (Number(srv) == srv) {\n        srv = Number(srv);\n      }\n\n      if (\"number\" == typeof srv) {\n        debug(\"creating http server and binding to %d\", srv);\n        var port = srv;\n        srv = http.createServer(function (req, res) {\n          res.writeHead(404);\n          res.end();\n        });\n        srv.listen(port);\n      } // merge the options passed to the Socket.IO server\n\n\n      Object.assign(opts, this.opts); // set engine.io path to `/socket.io`\n\n      opts.path = opts.path || this._path;\n      this.initEngine(srv, opts);\n      return this;\n    }\n    /**\n     * Initialize engine\n     *\n     * @param srv - the server to attach to\n     * @param opts - options passed to engine.io\n     * @private\n     */\n\n  }, {\n    key: \"initEngine\",\n    value: function initEngine(srv, opts) {\n      // initialize engine\n      debug(\"creating engine.io instance with opts %j\", opts);\n      this.eio = engine.attach(srv, opts); // attach static file serving\n\n      if (this._serveClient) this.attachServe(srv); // Export http server\n\n      this.httpServer = srv; // bind to engine events\n\n      this.bind(this.eio);\n    }\n    /**\n     * Attaches the static file serving.\n     *\n     * @param {Function|http.Server} srv http server\n     * @private\n     */\n\n  }, {\n    key: \"attachServe\",\n    value: function attachServe(srv) {\n      var _this3 = this;\n\n      debug(\"attaching client serving req handler\");\n      var evs = srv.listeners(\"request\").slice(0);\n      srv.removeAllListeners(\"request\");\n      srv.on(\"request\", function (req, res) {\n        if (_this3.clientPathRegex.test(req.url)) {\n          _this3.serve(req, res);\n        } else {\n          for (var i = 0; i < evs.length; i++) {\n            evs[i].call(srv, req, res);\n          }\n        }\n      });\n    }\n    /**\n     * Handles a request serving of client source and map\n     *\n     * @param {http.IncomingMessage} req\n     * @param {http.ServerResponse} res\n     * @private\n     */\n\n  }, {\n    key: \"serve\",\n    value: function serve(req, res) {\n      var filename = req.url.replace(this._path, \"\");\n      var isMap = dotMapRegex.test(filename);\n      var type = isMap ? \"map\" : \"source\"; // Per the standard, ETags must be quoted:\n      // https://tools.ietf.org/html/rfc7232#section-2.3\n\n      var expectedEtag = '\"' + clientVersion + '\"';\n      var etag = req.headers[\"if-none-match\"];\n\n      if (etag) {\n        if (expectedEtag == etag) {\n          debug(\"serve client %s 304\", type);\n          res.writeHead(304);\n          res.end();\n          return;\n        }\n      }\n\n      debug(\"serve client %s\", type);\n      res.setHeader(\"Cache-Control\", \"public, max-age=0\");\n      res.setHeader(\"Content-Type\", \"application/\" + (isMap ? \"json\" : \"javascript\"));\n      res.setHeader(\"ETag\", expectedEtag);\n\n      if (!isMap) {\n        res.setHeader(\"X-SourceMap\", filename.substring(1) + \".map\");\n      }\n\n      Server.sendFile(filename, req, res);\n    }\n    /**\n     * @param filename\n     * @param req\n     * @param res\n     * @private\n     */\n\n  }, {\n    key: \"bind\",\n\n    /**\n     * Binds socket.io to an engine.io instance.\n     *\n     * @param {engine.Server} engine engine.io (or compatible) server\n     * @return {Server} self\n     * @public\n     */\n    value: function bind(engine) {\n      this.engine = engine;\n      this.engine.on(\"connection\", this.onconnection.bind(this));\n      return this;\n    }\n    /**\n     * Called with each incoming transport connection.\n     *\n     * @param {engine.Socket} conn\n     * @return {Server} self\n     * @private\n     */\n\n  }, {\n    key: \"onconnection\",\n    value: function onconnection(conn) {\n      debug(\"incoming connection with id %s\", conn.id);\n      new client_1.Client(this, conn);\n      return this;\n    }\n    /**\n     * Looks up a namespace.\n     *\n     * @param {String|RegExp|Function} name nsp name\n     * @param {Function} [fn] optional, nsp `connection` ev handler\n     * @public\n     */\n\n  }, {\n    key: \"of\",\n    value: function of(name, fn) {\n      if (typeof name === \"function\" || name instanceof RegExp) {\n        var parentNsp = new parent_namespace_1.ParentNamespace(this);\n        debug(\"initializing parent namespace %s\", parentNsp.name);\n\n        if (typeof name === \"function\") {\n          this.parentNsps.set(name, parentNsp);\n        } else {\n          this.parentNsps.set(function (nsp, conn, next) {\n            return next(null, name.test(nsp));\n          }, parentNsp);\n        }\n\n        if (fn) {\n          // @ts-ignore\n          parentNsp.on(\"connect\", fn);\n        }\n\n        return parentNsp;\n      }\n\n      if (String(name)[0] !== \"/\") name = \"/\" + name;\n\n      var nsp = this._nsps.get(name);\n\n      if (!nsp) {\n        debug(\"initializing namespace %s\", name);\n        nsp = new namespace_1.Namespace(this, name);\n\n        this._nsps.set(name, nsp);\n      }\n\n      if (fn) nsp.on(\"connect\", fn);\n      return nsp;\n    }\n    /**\n     * Closes server connection\n     *\n     * @param {Function} [fn] optional, called as `fn([err])` on error OR all conns closed\n     * @public\n     */\n\n  }, {\n    key: \"close\",\n    value: function close(fn) {\n      var _iterator2 = _createForOfIteratorHelper(this.sockets.sockets.values()),\n          _step2;\n\n      try {\n        for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n          var socket = _step2.value;\n\n          socket._onclose(\"server shutting down\");\n        }\n      } catch (err) {\n        _iterator2.e(err);\n      } finally {\n        _iterator2.f();\n      }\n\n      this.engine.close();\n\n      if (this.httpServer) {\n        this.httpServer.close(fn);\n      } else {\n        fn && fn();\n      }\n    }\n    /**\n     * Sets up namespace middleware.\n     *\n     * @return {Server} self\n     * @public\n     */\n\n  }, {\n    key: \"use\",\n    value: function use(fn) {\n      this.sockets.use(fn);\n      return this;\n    }\n    /**\n     * Targets a room when emitting.\n     *\n     * @param {String} name\n     * @return {Server} self\n     * @public\n     */\n\n  }, {\n    key: \"to\",\n    value: function to(name) {\n      this.sockets.to(name);\n      return this;\n    }\n    /**\n     * Targets a room when emitting.\n     *\n     * @param {String} name\n     * @return {Server} self\n     * @public\n     */\n\n  }, {\n    key: \"in\",\n    value: function _in(name) {\n      this.sockets.in(name);\n      return this;\n    }\n    /**\n     * Sends a `message` event to all clients.\n     *\n     * @return {Server} self\n     * @public\n     */\n\n  }, {\n    key: \"send\",\n    value: function send() {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      args.unshift(\"message\");\n      this.sockets.emit.apply(this.sockets, args);\n      return this;\n    }\n    /**\n     * Sends a `message` event to all clients.\n     *\n     * @return {Server} self\n     * @public\n     */\n\n  }, {\n    key: \"write\",\n    value: function write() {\n      for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n        args[_key2] = arguments[_key2];\n      }\n\n      args.unshift(\"message\");\n      this.sockets.emit.apply(this.sockets, args);\n      return this;\n    }\n    /**\n     * Gets a list of socket ids.\n     *\n     * @public\n     */\n\n  }, {\n    key: \"allSockets\",\n    value: function allSockets() {\n      return this.sockets.allSockets();\n    }\n    /**\n     * Sets the compress flag.\n     *\n     * @param {Boolean} compress - if `true`, compresses the sending data\n     * @return {Server} self\n     * @public\n     */\n\n  }, {\n    key: \"compress\",\n    value: function compress(_compress) {\n      this.sockets.compress(_compress);\n      return this;\n    }\n    /**\n     * Sets a modifier for a subsequent event emission that the event data may be lost if the client is not ready to\n     * receive messages (because of network slowness or other issues, or because they’re connected through long polling\n     * and is in the middle of a request-response cycle).\n     *\n     * @return {Server} self\n     * @public\n     */\n\n  }, {\n    key: \"volatile\",\n    get: function get() {\n      this.sockets.volatile;\n      return this;\n    }\n    /**\n     * Sets a modifier for a subsequent event emission that the event data will only be broadcast to the current node.\n     *\n     * @return {Server} self\n     * @public\n     */\n\n  }, {\n    key: \"local\",\n    get: function get() {\n      this.sockets.local;\n      return this;\n    }\n  }], [{\n    key: \"sendFile\",\n    value: function sendFile(filename, req, res) {\n      var readStream = fs_1.createReadStream(path.join(__dirname, \"../client-dist/\", filename));\n      var encoding = accepts(req).encodings([\"br\", \"gzip\", \"deflate\"]);\n\n      var onError = function onError(err) {\n        if (err) {\n          res.end();\n        }\n      };\n\n      switch (encoding) {\n        case \"br\":\n          res.writeHead(200, {\n            \"content-encoding\": \"br\"\n          });\n          readStream.pipe(zlib_1.createBrotliCompress()).pipe(res);\n          stream_1.pipeline(readStream, zlib_1.createBrotliCompress(), res, onError);\n          break;\n\n        case \"gzip\":\n          res.writeHead(200, {\n            \"content-encoding\": \"gzip\"\n          });\n          stream_1.pipeline(readStream, zlib_1.createGzip(), res, onError);\n          break;\n\n        case \"deflate\":\n          res.writeHead(200, {\n            \"content-encoding\": \"deflate\"\n          });\n          stream_1.pipeline(readStream, zlib_1.createDeflate(), res, onError);\n          break;\n\n        default:\n          res.writeHead(200);\n          stream_1.pipeline(readStream, res, onError);\n      }\n    }\n  }]);\n\n  return Server;\n}(events_1.EventEmitter);\n\nexports.Server = Server;\n/**\n * Expose main namespace (/).\n */\n\nvar emitterMethods = Object.keys(events_1.EventEmitter.prototype).filter(function (key) {\n  return typeof events_1.EventEmitter.prototype[key] === \"function\";\n});\nemitterMethods.forEach(function (fn) {\n  Server.prototype[fn] = function () {\n    return this.sockets[fn].apply(this.sockets, arguments);\n  };\n});\n\nmodule.exports = function (srv, opts) {\n  return new Server(srv, opts);\n};\n\nmodule.exports.Server = Server;","map":{"version":3,"sources":["C:/Users/Human/Documents/MildMayhemFull/mildmayhem/client/node_modules/socket.io/dist/index.js"],"names":["__createBinding","Object","create","o","m","k","k2","undefined","defineProperty","enumerable","get","__setModuleDefault","v","value","__importStar","mod","__esModule","result","prototype","hasOwnProperty","call","__importDefault","exports","Namespace","Socket","Server","http","require","fs_1","zlib_1","accepts","stream_1","path","engine","client_1","events_1","namespace_1","parent_namespace_1","socket_io_adapter_1","parser","debug_1","socket_1","debug","default","clientVersion","version","dotMapRegex","srv","opts","_nsps","Map","parentNsps","listen","connectTimeout","serveClient","_parser","encoder","Encoder","adapter","Adapter","sockets","of","attach","arguments","length","_serveClient","name","auth","fn","size","keysIterator","keys","run","nextFn","next","done","err","allow","createChild","_path","replace","escapedPath","clientPathRegex","RegExp","_connectTimeout","_adapter","values","nsp","_initAdapter","msg","Error","Number","port","createServer","req","res","writeHead","end","assign","initEngine","eio","attachServe","httpServer","bind","evs","listeners","slice","removeAllListeners","on","test","url","serve","i","filename","isMap","type","expectedEtag","etag","headers","setHeader","substring","sendFile","onconnection","conn","id","Client","parentNsp","ParentNamespace","set","String","socket","_onclose","close","use","to","in","args","unshift","emit","apply","allSockets","compress","volatile","local","readStream","createReadStream","join","__dirname","encoding","encodings","onError","pipe","createBrotliCompress","pipeline","createGzip","createDeflate","EventEmitter","emitterMethods","filter","key","forEach","module"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Namespace = exports.Socket = exports.Server = void 0;\nconst http = require(\"http\");\nconst fs_1 = require(\"fs\");\nconst zlib_1 = require(\"zlib\");\nconst accepts = require(\"accepts\");\nconst stream_1 = require(\"stream\");\nconst path = require(\"path\");\nconst engine = require(\"engine.io\");\nconst client_1 = require(\"./client\");\nconst events_1 = require(\"events\");\nconst namespace_1 = require(\"./namespace\");\nObject.defineProperty(exports, \"Namespace\", { enumerable: true, get: function () { return namespace_1.Namespace; } });\nconst parent_namespace_1 = require(\"./parent-namespace\");\nconst socket_io_adapter_1 = require(\"socket.io-adapter\");\nconst parser = __importStar(require(\"socket.io-parser\"));\nconst debug_1 = __importDefault(require(\"debug\"));\nconst socket_1 = require(\"./socket\");\nObject.defineProperty(exports, \"Socket\", { enumerable: true, get: function () { return socket_1.Socket; } });\nconst debug = debug_1.default(\"socket.io:server\");\nconst clientVersion = require(\"../package.json\").version;\nconst dotMapRegex = /\\.map/;\nclass Server extends events_1.EventEmitter {\n    constructor(srv, opts = {}) {\n        super();\n        /**\n         * @private\n         */\n        this._nsps = new Map();\n        this.parentNsps = new Map();\n        if (\"object\" == typeof srv && srv instanceof Object && !srv.listen) {\n            opts = srv;\n            srv = null;\n        }\n        this.path(opts.path || \"/socket.io\");\n        this.connectTimeout(opts.connectTimeout || 45000);\n        this.serveClient(false !== opts.serveClient);\n        this._parser = opts.parser || parser;\n        this.encoder = new this._parser.Encoder();\n        this.adapter(opts.adapter || socket_io_adapter_1.Adapter);\n        this.sockets = this.of(\"/\");\n        this.opts = opts;\n        if (srv)\n            this.attach(srv);\n    }\n    serveClient(v) {\n        if (!arguments.length)\n            return this._serveClient;\n        this._serveClient = v;\n        return this;\n    }\n    /**\n     * Executes the middleware for an incoming namespace not already created on the server.\n     *\n     * @param {String} name - name of incoming namespace\n     * @param {Object} auth - the auth parameters\n     * @param {Function} fn - callback\n     *\n     * @private\n     */\n    _checkNamespace(name, auth, fn) {\n        if (this.parentNsps.size === 0)\n            return fn(false);\n        const keysIterator = this.parentNsps.keys();\n        const run = () => {\n            let nextFn = keysIterator.next();\n            if (nextFn.done) {\n                return fn(false);\n            }\n            nextFn.value(name, auth, (err, allow) => {\n                if (err || !allow) {\n                    run();\n                }\n                else {\n                    fn(this.parentNsps.get(nextFn.value).createChild(name));\n                }\n            });\n        };\n        run();\n    }\n    path(v) {\n        if (!arguments.length)\n            return this._path;\n        this._path = v.replace(/\\/$/, \"\");\n        const escapedPath = this._path.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, \"\\\\$&\");\n        this.clientPathRegex = new RegExp(\"^\" +\n            escapedPath +\n            \"/socket\\\\.io(\\\\.min|\\\\.msgpack\\\\.min)?\\\\.js(\\\\.map)?$\");\n        return this;\n    }\n    connectTimeout(v) {\n        if (v === undefined)\n            return this._connectTimeout;\n        this._connectTimeout = v;\n        return this;\n    }\n    adapter(v) {\n        if (!arguments.length)\n            return this._adapter;\n        this._adapter = v;\n        for (const nsp of this._nsps.values()) {\n            nsp._initAdapter();\n        }\n        return this;\n    }\n    listen(srv, opts = {}) {\n        return this.attach(srv, opts);\n    }\n    attach(srv, opts = {}) {\n        if (\"function\" == typeof srv) {\n            const msg = \"You are trying to attach socket.io to an express \" +\n                \"request handler function. Please pass a http.Server instance.\";\n            throw new Error(msg);\n        }\n        // handle a port as a string\n        if (Number(srv) == srv) {\n            srv = Number(srv);\n        }\n        if (\"number\" == typeof srv) {\n            debug(\"creating http server and binding to %d\", srv);\n            const port = srv;\n            srv = http.createServer((req, res) => {\n                res.writeHead(404);\n                res.end();\n            });\n            srv.listen(port);\n        }\n        // merge the options passed to the Socket.IO server\n        Object.assign(opts, this.opts);\n        // set engine.io path to `/socket.io`\n        opts.path = opts.path || this._path;\n        this.initEngine(srv, opts);\n        return this;\n    }\n    /**\n     * Initialize engine\n     *\n     * @param srv - the server to attach to\n     * @param opts - options passed to engine.io\n     * @private\n     */\n    initEngine(srv, opts) {\n        // initialize engine\n        debug(\"creating engine.io instance with opts %j\", opts);\n        this.eio = engine.attach(srv, opts);\n        // attach static file serving\n        if (this._serveClient)\n            this.attachServe(srv);\n        // Export http server\n        this.httpServer = srv;\n        // bind to engine events\n        this.bind(this.eio);\n    }\n    /**\n     * Attaches the static file serving.\n     *\n     * @param {Function|http.Server} srv http server\n     * @private\n     */\n    attachServe(srv) {\n        debug(\"attaching client serving req handler\");\n        const evs = srv.listeners(\"request\").slice(0);\n        srv.removeAllListeners(\"request\");\n        srv.on(\"request\", (req, res) => {\n            if (this.clientPathRegex.test(req.url)) {\n                this.serve(req, res);\n            }\n            else {\n                for (let i = 0; i < evs.length; i++) {\n                    evs[i].call(srv, req, res);\n                }\n            }\n        });\n    }\n    /**\n     * Handles a request serving of client source and map\n     *\n     * @param {http.IncomingMessage} req\n     * @param {http.ServerResponse} res\n     * @private\n     */\n    serve(req, res) {\n        const filename = req.url.replace(this._path, \"\");\n        const isMap = dotMapRegex.test(filename);\n        const type = isMap ? \"map\" : \"source\";\n        // Per the standard, ETags must be quoted:\n        // https://tools.ietf.org/html/rfc7232#section-2.3\n        const expectedEtag = '\"' + clientVersion + '\"';\n        const etag = req.headers[\"if-none-match\"];\n        if (etag) {\n            if (expectedEtag == etag) {\n                debug(\"serve client %s 304\", type);\n                res.writeHead(304);\n                res.end();\n                return;\n            }\n        }\n        debug(\"serve client %s\", type);\n        res.setHeader(\"Cache-Control\", \"public, max-age=0\");\n        res.setHeader(\"Content-Type\", \"application/\" + (isMap ? \"json\" : \"javascript\"));\n        res.setHeader(\"ETag\", expectedEtag);\n        if (!isMap) {\n            res.setHeader(\"X-SourceMap\", filename.substring(1) + \".map\");\n        }\n        Server.sendFile(filename, req, res);\n    }\n    /**\n     * @param filename\n     * @param req\n     * @param res\n     * @private\n     */\n    static sendFile(filename, req, res) {\n        const readStream = fs_1.createReadStream(path.join(__dirname, \"../client-dist/\", filename));\n        const encoding = accepts(req).encodings([\"br\", \"gzip\", \"deflate\"]);\n        const onError = err => {\n            if (err) {\n                res.end();\n            }\n        };\n        switch (encoding) {\n            case \"br\":\n                res.writeHead(200, { \"content-encoding\": \"br\" });\n                readStream.pipe(zlib_1.createBrotliCompress()).pipe(res);\n                stream_1.pipeline(readStream, zlib_1.createBrotliCompress(), res, onError);\n                break;\n            case \"gzip\":\n                res.writeHead(200, { \"content-encoding\": \"gzip\" });\n                stream_1.pipeline(readStream, zlib_1.createGzip(), res, onError);\n                break;\n            case \"deflate\":\n                res.writeHead(200, { \"content-encoding\": \"deflate\" });\n                stream_1.pipeline(readStream, zlib_1.createDeflate(), res, onError);\n                break;\n            default:\n                res.writeHead(200);\n                stream_1.pipeline(readStream, res, onError);\n        }\n    }\n    /**\n     * Binds socket.io to an engine.io instance.\n     *\n     * @param {engine.Server} engine engine.io (or compatible) server\n     * @return {Server} self\n     * @public\n     */\n    bind(engine) {\n        this.engine = engine;\n        this.engine.on(\"connection\", this.onconnection.bind(this));\n        return this;\n    }\n    /**\n     * Called with each incoming transport connection.\n     *\n     * @param {engine.Socket} conn\n     * @return {Server} self\n     * @private\n     */\n    onconnection(conn) {\n        debug(\"incoming connection with id %s\", conn.id);\n        new client_1.Client(this, conn);\n        return this;\n    }\n    /**\n     * Looks up a namespace.\n     *\n     * @param {String|RegExp|Function} name nsp name\n     * @param {Function} [fn] optional, nsp `connection` ev handler\n     * @public\n     */\n    of(name, fn) {\n        if (typeof name === \"function\" || name instanceof RegExp) {\n            const parentNsp = new parent_namespace_1.ParentNamespace(this);\n            debug(\"initializing parent namespace %s\", parentNsp.name);\n            if (typeof name === \"function\") {\n                this.parentNsps.set(name, parentNsp);\n            }\n            else {\n                this.parentNsps.set((nsp, conn, next) => next(null, name.test(nsp)), parentNsp);\n            }\n            if (fn) {\n                // @ts-ignore\n                parentNsp.on(\"connect\", fn);\n            }\n            return parentNsp;\n        }\n        if (String(name)[0] !== \"/\")\n            name = \"/\" + name;\n        let nsp = this._nsps.get(name);\n        if (!nsp) {\n            debug(\"initializing namespace %s\", name);\n            nsp = new namespace_1.Namespace(this, name);\n            this._nsps.set(name, nsp);\n        }\n        if (fn)\n            nsp.on(\"connect\", fn);\n        return nsp;\n    }\n    /**\n     * Closes server connection\n     *\n     * @param {Function} [fn] optional, called as `fn([err])` on error OR all conns closed\n     * @public\n     */\n    close(fn) {\n        for (const socket of this.sockets.sockets.values()) {\n            socket._onclose(\"server shutting down\");\n        }\n        this.engine.close();\n        if (this.httpServer) {\n            this.httpServer.close(fn);\n        }\n        else {\n            fn && fn();\n        }\n    }\n    /**\n     * Sets up namespace middleware.\n     *\n     * @return {Server} self\n     * @public\n     */\n    use(fn) {\n        this.sockets.use(fn);\n        return this;\n    }\n    /**\n     * Targets a room when emitting.\n     *\n     * @param {String} name\n     * @return {Server} self\n     * @public\n     */\n    to(name) {\n        this.sockets.to(name);\n        return this;\n    }\n    /**\n     * Targets a room when emitting.\n     *\n     * @param {String} name\n     * @return {Server} self\n     * @public\n     */\n    in(name) {\n        this.sockets.in(name);\n        return this;\n    }\n    /**\n     * Sends a `message` event to all clients.\n     *\n     * @return {Server} self\n     * @public\n     */\n    send(...args) {\n        args.unshift(\"message\");\n        this.sockets.emit.apply(this.sockets, args);\n        return this;\n    }\n    /**\n     * Sends a `message` event to all clients.\n     *\n     * @return {Server} self\n     * @public\n     */\n    write(...args) {\n        args.unshift(\"message\");\n        this.sockets.emit.apply(this.sockets, args);\n        return this;\n    }\n    /**\n     * Gets a list of socket ids.\n     *\n     * @public\n     */\n    allSockets() {\n        return this.sockets.allSockets();\n    }\n    /**\n     * Sets the compress flag.\n     *\n     * @param {Boolean} compress - if `true`, compresses the sending data\n     * @return {Server} self\n     * @public\n     */\n    compress(compress) {\n        this.sockets.compress(compress);\n        return this;\n    }\n    /**\n     * Sets a modifier for a subsequent event emission that the event data may be lost if the client is not ready to\n     * receive messages (because of network slowness or other issues, or because they’re connected through long polling\n     * and is in the middle of a request-response cycle).\n     *\n     * @return {Server} self\n     * @public\n     */\n    get volatile() {\n        this.sockets.volatile;\n        return this;\n    }\n    /**\n     * Sets a modifier for a subsequent event emission that the event data will only be broadcast to the current node.\n     *\n     * @return {Server} self\n     * @public\n     */\n    get local() {\n        this.sockets.local;\n        return this;\n    }\n}\nexports.Server = Server;\n/**\n * Expose main namespace (/).\n */\nconst emitterMethods = Object.keys(events_1.EventEmitter.prototype).filter(function (key) {\n    return typeof events_1.EventEmitter.prototype[key] === \"function\";\n});\nemitterMethods.forEach(function (fn) {\n    Server.prototype[fn] = function () {\n        return this.sockets[fn].apply(this.sockets, arguments);\n    };\n});\nmodule.exports = (srv, opts) => new Server(srv, opts);\nmodule.exports.Server = Server;\n"]},"metadata":{},"sourceType":"script"}